<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control Financiero</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .login-container {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            max-width: 400px;
            width: 90%;
        }
        .login-container h1 { color: #2c3e50; margin-bottom: 10px; text-align: center; }
        .login-container p { color: #7f8c8d; margin-bottom: 30px; text-align: center; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; color: #2c3e50; font-weight: bold; }
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
        }
        .btn-login {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }
        .error-msg {
            background: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
            text-align: center;
        }
        .app-container {
            display: none;
            max-width: 1400px;
            width: 95%;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 12px;
        }
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logout-btn {
            padding: 8px 16px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab {
            padding: 12px 24px;
            background: #34495e;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        .tab.active { background: #3498db; }
        .content { display: none; background: white; padding: 20px; border-radius: 8px; }
        .content.active { display: block; }
        .filtros {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
        }
        .resumen-mensual {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .resumen-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .resumen-item {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 6px;
            text-align: center;
        }
        .resumen-item .valor { font-size: 24px; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { background: #34495e; color: white; padding: 12px; text-align: left; }
        td { padding: 10px; border-bottom: 1px solid #ddd; }
        .btn-delete { 
            background: #e74c3c; 
            color: white; 
            border: none; 
            padding: 5px 10px; 
            border-radius: 4px; 
            cursor: pointer;
            font-size: 12px;
        }
        .btn-delete:hover { background: #c0392b; }
        .export-btns {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .btn-export {
            padding: 10px 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-export:hover { background: #2980b9; }
        input, select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .ingreso { background: #d4edda; }
        .egreso { background: #f8d7da; }
        .saldo { background: #d1ecf1; font-weight: bold; }
        .add-row {
            margin-top: 15px;
            padding: 10px 20px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        .credentials-info {
            background: #d1ecf1;
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
        }
        .instrucciones {
            background: #fff3cd;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border-left: 4px solid #ffc107;
        }
    </style>
</head>
<body>
    <div class="login-container" id="loginContainer">
        <h1>üîê Acceso Seguro</h1>
        <p>Control Financiero Personal</p>
        <div class="error-msg" id="errorMsg">Usuario o contrase√±a incorrectos</div>
        <form onsubmit="login(event)">
            <div class="form-group">
                <label>Usuario</label>
                <input type="text" id="username" required>
            </div>
            <div class="form-group">
                <label>Contrase√±a</label>
                <input type="password" id="password" required>
            </div>
            <button type="submit" class="btn-login">Ingresar</button>
        </form>
        <div class="credentials-info">
            <strong>üìå Credenciales:</strong><br>
            Usuario: <code>jorel</code><br>
            Contrase√±a: <code>finanzas2026</code>
        </div>
    </div>

    <div class="app-container" id="appContainer">
        <div class="header">
            <div>
                <h1>üí∞ Control de Ingresos y Egresos</h1>
                <p style="margin: 5px 0 0 0;">Negocio: Video, Fotograf√≠a, Web, Redes Sociales, Impresiones</p>
            </div>
            <button class="logout-btn" onclick="logout()">üö™ Cerrar Sesi√≥n</button>
        </div>

        <div class="instrucciones">
            <strong>üìã Instrucciones:</strong> Tus datos se guardan autom√°ticamente. El saldo se calcula fila por fila sumando ingresos y restando egresos.
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('negocio')">üè¢ NEGOCIO</button>
            <button class="tab" onclick="showTab('personal')">üë§ PERSONAL</button>
        </div>

        <div id="negocio" class="content active">
            <h2>Control de Negocio</h2>
            <div class="filtros">
                <label>üìÖ Mes:</label>
                <select id="mesNegocio" onchange="filtrarNegocio()">
                    <option value="todos">Todos</option>
                </select>
                <select id="anioNegocio" onchange="filtrarNegocio()">
                    <option value="2026">2026</option>
                    <option value="2025">2025</option>
                </select>
            </div>

            <div class="resumen-mensual">
                <h3>üìä Resumen</h3>
                <div class="resumen-grid">
                    <div class="resumen-item">
                        <div class="label">Ingresos</div>
                        <div class="valor" id="rIngN">$0</div>
                    </div>
                    <div class="resumen-item">
                        <div class="label">Egresos</div>
                        <div class="valor" id="rEgrN">$0</div>
                    </div>
                    <div class="resumen-item">
                        <div class="label">Balance</div>
                        <div class="valor" id="rBalN">$0</div>
                    </div>
                    <div class="resumen-item">
                        <div class="label">Saldo Final</div>
                        <div class="valor" id="rSaldoN">$5,000</div>
                    </div>
                </div>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Descripci√≥n</th>
                        <th>Categor√≠a</th>
                        <th class="ingreso">Ingreso</th>
                        <th class="egreso">Egreso</th>
                        <th class="saldo">Saldo</th>
                        <th style="width: 60px;">Acci√≥n</th>
                    </tr>
                </thead>
                <tbody id="bodyNegocio">
                    <tr>
                        <td><input type="date" value="2026-01-16" onchange="guardar()"></td>
                        <td><input type="text" value="Saldo inicial" onchange="guardar()"></td>
                        <td><select onchange="guardar()"><option>Inicial</option></select></td>
                        <td class="ingreso"><input type="number" value="0" readonly></td>
                        <td class="egreso"><input type="number" value="0" readonly></td>
                        <td class="saldo"><input type="number" value="5000" onchange="calc('n');guardar()"></td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
            <button class="add-row" onclick="add('n')">‚ûï Agregar</button>
            <div class="export-btns">
                <button class="btn-export" onclick="exportarExcel('n')">üìä Descargar Excel</button>
                <button class="btn-export" onclick="exportarCSV('n')">üìÑ Descargar CSV</button>
            </div>
        </div>

        <div id="personal" class="content">
            <h2>Control Personal</h2>
            <div class="filtros">
                <label>üìÖ Mes:</label>
                <select id="mesPersonal" onchange="filtrarPersonal()">
                    <option value="todos">Todos</option>
                </select>
                <select id="anioPersonal" onchange="filtrarPersonal()">
                    <option value="2026">2026</option>
                    <option value="2025">2025</option>
                </select>
            </div>

            <div class="resumen-mensual">
                <h3>üìä Resumen</h3>
                <div class="resumen-grid">
                    <div class="resumen-item">
                        <div class="label">Ingresos</div>
                        <div class="valor" id="rIngP">$0</div>
                    </div>
                    <div class="resumen-item">
                        <div class="label">Egresos</div>
                        <div class="valor" id="rEgrP">$0</div>
                    </div>
                    <div class="resumen-item">
                        <div class="label">Balance</div>
                        <div class="valor" id="rBalP">$0</div>
                    </div>
                    <div class="resumen-item">
                        <div class="label">Saldo Final</div>
                        <div class="valor" id="rSaldoP">$3,000</div>
                    </div>
                </div>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Descripci√≥n</th>
                        <th>Categor√≠a</th>
                        <th class="ingreso">Ingreso</th>
                        <th class="egreso">Egreso</th>
                        <th class="saldo">Saldo</th>
                        <th style="width: 60px;">Acci√≥n</th>
                    </tr>
                </thead>
                <tbody id="bodyPersonal">
                    <tr>
                        <td><input type="date" value="2026-01-16" onchange="guardar()"></td>
                        <td><input type="text" value="Saldo inicial" onchange="guardar()"></td>
                        <td><select onchange="guardar()"><option>Inicial</option></select></td>
                        <td class="ingreso"><input type="number" value="0" readonly></td>
                        <td class="egreso"><input type="number" value="0" readonly></td>
                        <td class="saldo"><input type="number" value="3000" onchange="calc('p');guardar()"></td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
            <button class="add-row" onclick="add('p')">‚ûï Agregar</button>
            <div class="export-btns">
                <button class="btn-export" onclick="exportarExcel('p')">üìä Descargar Excel</button>
                <button class="btn-export" onclick="exportarCSV('p')">üìÑ Descargar CSV</button>
            </div>
        </div>
    </div>

    <script>
        const meses = ['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];
        const catN = ['Inicial','Video y Fotograf√≠a','P√°ginas Web','Redes Sociales','Impresiones','Paquetes/Combo','Anticipos','Equipo','Software y Suscripciones','Insumos','Subcontrataci√≥n','Gastos operativos','Marketing','Transporte','Capacitaci√≥n','Mantenimiento','Otros'];
        const catP = ['Inicial','Sueldo','Vivienda','Servicios','Gastos diarios','Compras grandes','Deudas','Ahorro','Salud','Entretenimiento','Otros'];

        function login(e) {
            e.preventDefault();
            if (document.getElementById('username').value === 'jorel' && document.getElementById('password').value === 'finanzas2026') {
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('appContainer').style.display = 'block';
                document.body.style.background = '#f5f5f5';
                initMeses();
                cargar();
                calc('n');
                calc('p');
                filtrarNegocio();
                filtrarPersonal();
            } else {
                document.getElementById('errorMsg').style.display = 'block';
                setTimeout(() => document.getElementById('errorMsg').style.display = 'none', 3000);
            }
        }

        function logout() {
            guardar();
            document.getElementById('loginContainer').style.display = 'block';
            document.getElementById('appContainer').style.display = 'none';
            document.body.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        function showTab(t) {
            document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(b => b.classList.remove('active'));
            document.getElementById(t).classList.add('active');
            event.target.classList.add('active');
        }

        function initMeses() {
            ['mesNegocio','mesPersonal'].forEach(id => {
                const s = document.getElementById(id);
                meses.forEach((m,i) => {
                    const o = document.createElement('option');
                    o.value = i+1;
                    o.textContent = m;
                    s.appendChild(o);
                });
            });
        }

        function add(tipo) {
            const body = document.getElementById(tipo === 'n' ? 'bodyNegocio' : 'bodyPersonal');
            const cats = tipo === 'n' ? catN : catP;
            const row = body.insertRow();
            const hoy = new Date().toISOString().split('T')[0];
            row.innerHTML = `
                <td><input type="date" value="${hoy}" onchange="calc('${tipo}');guardar()"></td>
                <td><input type="text" placeholder="Descripci√≥n" onchange="guardar()"></td>
                <td><select onchange="guardar()">${cats.map(c => '<option>'+c+'</option>').join('')}</select></td>
                <td class="ingreso"><input type="number" step="0.01" value="0" oninput="calc('${tipo}')" onchange="guardar()" onfocus="this.select()"></td>
                <td class="egreso"><input type="number" step="0.01" value="0" oninput="calc('${tipo}')" onchange="guardar()" onfocus="this.select()"></td>
                <td class="saldo"><input type="number" readonly></td>
                <td><button class="btn-delete" onclick="borrarFila(this, '${tipo}')">‚ùå</button></td>
            `;
            calc(tipo);
            guardar();
        }

        function borrarFila(btn, tipo) {
            if (confirm('¬øSeguro que quieres borrar esta fila?')) {
                const row = btn.parentNode.parentNode;
                row.parentNode.removeChild(row);
                calc(tipo);
                guardar();
                tipo === 'n' ? filtrarNegocio() : filtrarPersonal();
            }
        }

        function calc(tipo) {
            const body = document.getElementById(tipo === 'n' ? 'bodyNegocio' : 'bodyPersonal');
            const rows = body.getElementsByTagName('tr');
            let saldoAnterior = 0;
            
            for (let i = 0; i < rows.length; i++) {
                const inp = rows[i].getElementsByTagName('input');
                const ing = parseFloat(inp[3].value) || 0;
                const egr = parseFloat(inp[4].value) || 0;
                
                if (i === 0) {
                    saldoAnterior = parseFloat(inp[5].value) || 0;
                    inp[5].value = saldoAnterior.toFixed(2);
                } else {
                    const saldoActual = saldoAnterior + ing - egr;
                    inp[5].value = saldoActual.toFixed(2);
                    saldoAnterior = saldoActual;
                }
            }
            
            tipo === 'n' ? filtrarNegocio() : filtrarPersonal();
        }

        function filtrarNegocio() {
            const mes = document.getElementById('mesNegocio').value;
            const anio = document.getElementById('anioNegocio').value;
            const body = document.getElementById('bodyNegocio');
            const rows = body.getElementsByTagName('tr');
            let ing = 0, egr = 0, saldoFinal = 0;
            
            for (let i = 1; i < rows.length; i++) {
                const fecha = rows[i].cells[0].querySelector('input').value;
                const [y,m] = fecha.split('-');
                if (mes === 'todos' || (m === String(mes).padStart(2,'0') && y === anio)) {
                    rows[i].style.display = '';
                    ing += parseFloat(rows[i].cells[3].querySelector('input').value) || 0;
                    egr += parseFloat(rows[i].cells[4].querySelector('input').value) || 0;
                } else {
                    rows[i].style.display = 'none';
                }
            }
            
            if (rows.length > 0) {
                saldoFinal = parseFloat(rows[rows.length - 1].cells[5].querySelector('input').value) || 0;
            }
            
            document.getElementById('rIngN').textContent = '$' + ing.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            document.getElementById('rEgrN').textContent = '$' + egr.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            document.getElementById('rBalN').textContent = '$' + (ing-egr).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            document.getElementById('rSaldoN').textContent = '$' + saldoFinal.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        function filtrarPersonal() {
            const mes = document.getElementById('mesPersonal').value;
            const anio = document.getElementById('anioPersonal').value;
            const body = document.getElementById('bodyPersonal');
            const rows = body.getElementsByTagName('tr');
            let ing = 0, egr = 0, saldoFinal = 0;
            
            for (let i = 1; i < rows.length; i++) {
                const fecha = rows[i].cells[0].querySelector('input').value;
                const [y,m] = fecha.split('-');
                if (mes === 'todos' || (m === String(mes).padStart(2,'0') && y === anio)) {
                    rows[i].style.display = '';
                    ing += parseFloat(rows[i].cells[3].querySelector('input').value) || 0;
                    egr += parseFloat(rows[i].cells[4].querySelector('input').value) || 0;
                } else {
                    rows[i].style.display = 'none';
                }
            }
            
            if (rows.length > 0) {
                saldoFinal = parseFloat(rows[rows.length - 1].cells[5].querySelector('input').value) || 0;
            }
            
            document.getElementById('rIngP').textContent = '$' + ing.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            document.getElementById('rEgrP').textContent = '$' + egr.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            document.getElementById('rBalP').textContent = '$' + (ing-egr).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            document.getElementById('rSaldoP').textContent = '$' + saldoFinal.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        function guardar() {
            const datosN = { rows: Array.from(document.getElementById('bodyNegocio').rows).map(r => ({
                fecha: r.cells[0].querySelector('input').value,
                desc: r.cells[1].querySelector('input').value,
                cat: r.cells[2].querySelector('select').value,
                ing: r.cells[3].querySelector('input').value,
                egr: r.cells[4].querySelector('input').value,
                saldo: r.cells[5].querySelector('input').value
            }))};

            const datosP = { rows: Array.from(document.getElementById('bodyPersonal').rows).map(r => ({
                fecha: r.cells[0].querySelector('input').value,
                desc: r.cells[1].querySelector('input').value,
                cat: r.cells[2].querySelector('select').value,
                ing: r.cells[3].querySelector('input').value,
                egr: r.cells[4].querySelector('input').value,
                saldo: r.cells[5].querySelector('input').value
            }))};

            try {
                localStorage.setItem('finanzasData', JSON.stringify({negocio: datosN, personal: datosP}));
            } catch(e) {
                console.error('Error guardando:', e);
            }
        }

        function cargar() {
            const datos = localStorage.getItem('finanzasData');
            if (!datos) return;
            
            const d = JSON.parse(datos);
            
            const bodyN = document.getElementById('bodyNegocio');
            bodyN.innerHTML = '';
            d.negocio.rows.forEach((r, i) => {
                const row = bodyN.insertRow();
                const isFirst = i === 0;
                row.innerHTML = `
                    <td><input type="date" value="${r.fecha}" onchange="calc('n');guardar()"></td>
                    <td><input type="text" value="${r.desc}" onchange="guardar()"></td>
                    <td><select onchange="guardar()">${catN.map(c => '<option'+(c===r.cat?' selected':'')+'>'+c+'</option>').join('')}</select></td>
                    <td class="ingreso"><input type="number" step="0.01" value="${r.ing}" ${isFirst?'readonly':''} oninput="calc('n')" onchange="guardar()" onfocus="this.select()"></td>
                    <td class="egreso"><input type="number" step="0.01" value="${r.egr}" ${isFirst?'readonly':''} oninput="calc('n')" onchange="guardar()" onfocus="this.select()"></td>
                    <td class="saldo"><input type="number" value="${r.saldo}" ${isFirst?'onchange="calc(\'n\');guardar()" onfocus="this.select()"':'readonly'}></td>
                    <td>${isFirst?'':'<button class="btn-delete" onclick="borrarFila(this, \'n\')">‚ùå</button>'}</td>
                `;
            });

            const bodyP = document.getElementById('bodyPersonal');
            bodyP.innerHTML = '';
            d.personal.rows.forEach((r, i) => {
                const row = bodyP.insertRow();
                const isFirst = i === 0;
                row.innerHTML = `
                    <td><input type="date" value="${r.fecha}" onchange="calc('p');guardar()"></td>
                    <td><input type="text" value="${r.desc}" onchange="guardar()"></td>
                    <td><select onchange="guardar()">${catP.map(c => '<option'+(c===r.cat?' selected':'')+'>'+c+'</option>').join('')}</select></td>
                    <td class="ingreso"><input type="number" step="0.01" value="${r.ing}" ${isFirst?'readonly':''} oninput="calc('p')" onchange="guardar()" onfocus="this.select()"></td>
                    <td class="egreso"><input type="number" step="0.01" value="${r.egr}" ${isFirst?'readonly':''} oninput="calc('p')" onchange="guardar()" onfocus="this.select()"></td>
                    <td class="saldo"><input type="number" value="${r.saldo}" ${isFirst?'onchange="calc(\'p\');guardar()" onfocus="this.select()"':'readonly'}></td>
                    <td>${isFirst?'':'<button class="btn-delete" onclick="borrarFila(this, \'p\')">‚ùå</button>'}</td>
                `;
            });
        }

        function exportarExcel(tipo) {
            const nombre = tipo === 'n' ? 'Negocio' : 'Personal';
            const body = document.getElementById(tipo === 'n' ? 'bodyNegocio' : 'bodyPersonal');
            const rows = body.getElementsByTagName('tr');
            
            let csv = 'Fecha,Descripcion,Categoria,Ingreso,Egreso,Saldo\n';
            
            for (let i = 0; i < rows.length; i++) {
                const inp = rows[i].getElementsByTagName('input');
                const sel = rows[i].getElementsByTagName('select')[0];
                const fecha = inp[0].value;
                const desc = inp[1].value.replace(/,/g, ';');
                const cat = sel.value.replace(/,/g, ';');
                const ing = inp[3].value;
                const egr = inp[4].value;
                const saldo = inp[5].value;
                csv += `${fecha},${desc},${cat},${ing},${egr},${saldo}\n`;
            }
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', `Control_${nombre}_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function exportarCSV(tipo) {
            exportarExcel(tipo);
        }
    </script>
</body>
</html>
